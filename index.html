<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Negocios con Ignacio ‚Äì Cat√°logo</title>
  <meta name="description" content="Cat√°logo de motos ‚Äì Negocios con Ignacio. Filtros, cuotas, comparador, galer√≠a, WhatsApp, eventos y test drive." />
  <link rel="icon" href="/images/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --gold:#C5A047; --dark:#0B0B0B; }
    body { background: var(--dark); color: #EEE; }
    .gold { color: var(--gold); }
    .btn { border:1px solid rgba(255,255,255,.18); border-radius:14px; padding:10px 14px; display:inline-flex; align-items:center; gap:8px; min-height:44px; }
    .btn:hover { box-shadow:0 8px 28px rgba(0,0,0,.35); }
    .card { background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); border-radius:18px; }
    .tag { font-size:12px; padding:2px 8px; border-radius:9999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); }
    .input, select {
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.28);
      color:#fff;
      border-radius:12px;
      padding:8px 12px;
      height:40px;
    }
    select, option { color:#fff; background:#111; }
    ::placeholder { color:#cfcfcf; opacity:.9; }
    .fixed-wa { position:fixed; right:16px; bottom:16px; z-index:50; }
    .grid-auto-fill { display:grid; grid-template-columns: repeat(auto-fill,minmax(270px,1fr)); gap:20px; }
    .iconbtn { border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); height:38px; padding:0 10px; border-radius:10px; display:inline-flex; align-items:center; gap:6px; font-size:13px; }
    a { color: inherit; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="sticky top-0 z-20 border-b border-white/10 bg-black/70 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-4">
      <!-- Logo m√°s grande en m√≥viles -->
      <img src="/images/logo.png" alt="Negocios con Ignacio" class="h-20 md:h-14 w-auto rounded-lg" onerror="this.src='https://dummyimage.com/200x80/111/ffffff&text=Negocios+con+Ignacio'">
      <span class="uppercase font-extrabold tracking-wide gold text-lg md:text-2xl">NEGOCIOS CON IGNACIO</span>
      <nav class="ml-auto hidden md:flex items-center gap-4 text-sm opacity-90">
        <a href="#catalogo" class="hover:opacity-100">Cat√°logo</a>
        <a href="#agenda" class="hover:opacity-100">Eventos & Test Drive</a>
        <a href="#comparador" class="hover:opacity-100">Comparador</a>
        <a href="#contacto" class="hover:opacity-100">Contacto</a>
      </nav>
      <a href="#catalogo" class="btn">üîé Buscar</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="mx-auto max-w-7xl px-4 py-10 md:py-14 grid md:grid-cols-2 gap-8 items-center">
    <div>
      <h1 class="text-3xl md:text-5xl font-extrabold leading-tight"><span class="gold">Eleg√≠ tu pr√≥xima moto</span> con asesoramiento real</h1>
      <p class="mt-3 text-zinc-300">Filtros, cuotas, galer√≠a, compartir por WhatsApp, <span class="gold font-semibold">eventos</span> y <span class="gold font-semibold">test drive</span>.</p>
      <div class="mt-5 flex flex-wrap items-center gap-3">
        <a href="#catalogo" class="btn">üõí Ver cat√°logo</a>
        <a href="#agenda" class="btn">üóìÔ∏è Eventos</a>
        <a id="wa-hero" target="_blank" class="btn" style="background: rgba(197,160,71,.18);">üìû WhatsApp</a>
      </div>
    </div>
    <div class="rounded-3xl overflow-hidden aspect-video md:aspect-[4/3] bg-cover bg-center" style="background-image:url('/images/hero.jpg'), linear-gradient(120deg,#111,#222)"></div>
  </section>

  <!-- Cat√°logo -->
  <section id="catalogo" class="mx-auto max-w-7xl px-4 pb-10">
    <div class="flex items-center justify-between gap-3 mb-3">
      <h2 class="text-2xl font-bold gold">Cat√°logo</h2>
      <div id="count" class="text-sm opacity-80"></div>
    </div>

    <!-- Filtros + orden -->
    <div class="card p-4 md:p-5 mb-6">
      <div class="grid grid-cols-2 md:grid-cols-12 gap-3 items-end">
        <label class="text-sm col-span-2 md:col-span-4">B√∫squeda
          <input id="q" placeholder="Modelo, marca, cc‚Ä¶" class="input w-full mt-1" />
        </label>
        <label class="text-sm md:col-span-2">Marca
          <select id="brand" class="w-full mt-1">
            <option value="">Todas</option>
            <option>Benelli</option>
            <option>Usadas</option>
          </select>
        </label>
        <label class="text-sm md:col-span-2">Min
          <input id="minPrice" type="number" class="input w-full mt-1" />
        </label>
        <label class="text-sm md:col-span-2">Max
          <input id="maxPrice" type="number" class="input w-full mt-1" />
        </label>

        <label class="text-sm md:col-span-2">Orden
          <select id="sort" class="w-full mt-1">
            <option value="none">‚Äî</option>
            <option value="price-asc">Precio ‚Üë</option>
            <option value="price-desc">Precio ‚Üì</option>
            <option value="cc-asc">Cilindrada ‚Üë</option>
            <option value="cc-desc">Cilindrada ‚Üì</option>
            <option value="year-desc">A√±o ‚Üì</option>
            <option value="year-asc">A√±o ‚Üë</option>
          </select>
        </label>

        <div class="text-sm md:col-span-2"><button id="clear" class="btn w-full">üßπ Limpiar</button></div>
      </div>

      <!-- Paginaci√≥n arriba -->
      <div class="mt-4 flex flex-wrap items-center justify-between gap-3">
        <div class="text-sm opacity-80">
          <label>Por p√°gina
            <select id="pageSize" class="input ml-2" style="height:36px;">
              <option>6</option><option selected>10</option><option>12</option><option>16</option>
            </select>
          </label>
        </div>
        <div class="flex items-center gap-2" id="pagerTop"></div>
      </div>
    </div>

    <div id="grid" class="grid-auto-fill"></div>

    <!-- Paginaci√≥n abajo -->
    <div class="mt-6 flex items-center justify-end gap-2" id="pagerBottom"></div>
  </section>

  <!-- Eventos & Test Drive -->
  <section id="agenda" class="mx-auto max-w-7xl px-4 pb-12">
    <h3 class="text-xl font-bold gold mb-3">Eventos & Test Drive</h3>

    <!-- Pr√≥ximo evento con contador -->
    <div id="nextEventWrap" class="card p-4 md:p-5 mb-5 hidden">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="text-xs uppercase tracking-wide opacity-70">Pr√≥ximo evento</div>
          <div id="nextEventTitle" class="text-lg font-semibold"></div>
          <div id="nextEventMeta" class="text-sm opacity-80"></div>
          <div id="nextEventDesc" class="text-sm opacity-80 mt-1"></div>
        </div>
        <div class="text-center">
          <div class="text-xs opacity-70 mb-1">Comienza en</div>
          <div id="countdown" class="text-2xl font-bold gold tabular-nums">‚Äî</div>
          <div class="mt-3 flex flex-wrap justify-center gap-2">
            <button id="nextEvAgenda" class="btn" style="background: rgba(197,160,71,.18);">üì≤ Agendar por WhatsApp</button>
            <button id="nextEvICS" class="btn">‚ûï Agregar al calendario</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card p-4 md:p-5">
      <div class="text-sm opacity-80 mb-4">Eleg√≠ un evento pr√≥ximo o ped√≠ un turno de test drive.</div>
      <div id="eventsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

      <div class="mt-6 border-t border-white/10 pt-5">
        <h4 class="font-semibold mb-2">Agendar Test Drive directo</h4>
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <label class="text-sm">Modelo
            <select id="td-model" class="input w-full mt-1">
              <option value="">Eleg√≠ un modelo‚Ä¶</option>
            </select>
          </label>
          <label class="text-sm">Fecha y hora
            <input id="td-dt" type="datetime-local" class="input w-full mt-1">
          </label>
          <label class="text-sm">Nombre
            <input id="td-name" class="input w-full mt-1" placeholder="Tu nombre">
          </label>
          <label class="text-sm">Tel√©fono
            <input id="td-phone" class="input w-full mt-1" placeholder="Tu tel√©fono">
          </label>
        </div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button id="td-wa" class="btn" style="background: rgba(197,160,71,.18);">üì≤ Reservar por WhatsApp</button>
          <button id="td-ics" class="btn">‚ûï Agregar a mi calendario (.ics)</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Comparador (placeholder visual) -->
  <section id="comparador" class="mx-auto max-w-7xl px-4 pb-12">
    <h3 class="text-xl font-bold gold mb-3">Comparador</h3>
    <div class="card p-4">
      <div id="compareList" class="text-sm opacity-80 mb-3">Eleg√≠ hasta 3 modelos desde el cat√°logo (bot√≥n ‚ÄúComparar‚Äù).</div>
      <div class="overflow-auto">
        <table id="compareTable" class="w-full text-sm">
          <thead>
            <tr class="border-b border-white/10">
              <th class="text-left p-2">Modelo</th>
              <th class="text-left p-2">Marca</th>
              <th class="text-left p-2">Cilindrada</th>
              <th class="text-left p-2">A√±o</th>
              <th class="text-left p-2">KM</th>
              <th class="text-left p-2">Precio</th>
            </tr>
          </thead>
          <tbody id="compareBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Contacto -->
  <footer id="contacto" class="border-t border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-8 grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div>
        <div class="font-semibold gold">Negocios con Ignacio</div>
        <div class="text-sm opacity-70 mt-1">M√°s de 2000 clientes. Asesoramiento real.</div>
      </div>
      <div>
        <div class="font-semibold gold">Contacto</div>
        <div class="text-sm opacity-70 mt-1">WhatsApp: 3512004885</div>
        <div class="text-sm opacity-70">C√≥rdoba, Argentina</div>
      </div>
      <div>
        <div class="font-semibold gold">Enlaces</div>
        <div class="flex items-center gap-3 mt-2 opacity-80">
          <a href="https://www.instagram.com" target="_blank" class="underline">Instagram</a>
          <a href="https://www.facebook.com" target="_blank" class="underline">Facebook</a>
        </div>
      </div>
      <div>
        <div class="font-semibold gold">Legales</div>
        <div class="text-xs opacity-70 mt-1">Defensa de las y los consumidores ‚Ä¢ Bot√≥n de arrepentimiento</div>
      </div>
    </div>
    <div class="text-xs opacity-70 text-center pb-8">¬© <span id="year"></span> Negociosconignacio</div>
  </footer>

  <!-- WhatsApp flotante -->
  <a id="wa-float" target="_blank" class="fixed-wa btn" style="background: rgba(197,160,71,.18);">üìû WhatsApp</a>

  <!-- Lightbox (galer√≠a) -->
  <div id="lightbox" class="fixed inset-0 z-50 hidden bg-black/70 backdrop-blur">
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="relative w-full max-w-4xl card p-3 bg-black">
        <button id="lb-close" class="absolute -top-3 -right-3 btn bg-black">‚úñ</button>
        <img id="lb-main" src="" alt="" class="w-full max-h-[70vh] object-contain rounded-xl">
        <div id="lb-thumbs" class="mt-3 grid grid-cols-6 gap-2"></div>
        <button id="lb-prev" class="absolute left-2 top-1/2 -translate-y-1/2 btn">‚óÄ</button>
        <button id="lb-next" class="absolute right-2 top-1/2 -translate-y-1/2 btn">‚ñ∂</button>
      </div>
    </div>
  </div>

  <!-- Calculadora (modal pantalla completa) -->
  <div id="calcbox" class="fixed inset-0 z-50 hidden bg-black/70 backdrop-blur">
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="relative w-full max-w-3xl card p-4 md:p-6 bg-black">
        <button id="cb-close" class="absolute -top-3 -right-3 btn bg-black">‚úñ</button>

        <h3 id="cb-title" class="text-xl md:text-2xl font-bold gold">Calculadora de cuotas</h3>
        <div id="cb-price" class="mt-1 text-zinc-300"></div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-5 gap-3">
          <label class="text-sm block">Entrega
            <input id="cb-entrega" type="number" class="input w-full mt-1" value="0" step="10000" min="0">
          </label>

          <label class="text-sm block">Meses
            <input id="cb-meses" type="number" class="input w-full mt-1" value="12" min="1" max="72">
          </label>

          <label class="text-sm block">Tipo de plan
            <select id="cb-plan" class="input w-full mt-1"></select>
          </label>

          <div class="text-sm flex flex-col justify-end">
            <div class="text-xs opacity-70">Cuota estimada</div>
            <div id="cb-cuota" class="text-2xl font-semibold gold">-</div>
          </div>

          <div id="cb-atajos" class="flex items-end gap-2 flex-wrap"></div>
        </div>

        <div class="mt-2 text-xs opacity-70">TNA estimada: <span id="cb-tna-view">-</span></div>
        <div class="mt-3 text-sm opacity-80" id="cb-monto">Monto a financiar: -</div>

        <div class="mt-5 flex flex-col md:flex-row gap-3">
          <a id="cb-wa" target="_blank" class="btn w-full md:w-auto" style="background: rgba(197,160,71,.18);">üìû Enviar por WhatsApp</a>
          <button id="cb-cerrar" class="btn w-full md:w-auto">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Agenda -->
  <div id="agendabox" class="fixed inset-0 z-50 hidden bg-black/70 backdrop-blur">
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="relative w-full max-w-2xl card p-4 md:p-6 bg-black">
        <button id="ab-close" class="absolute -top-3 -right-3 btn bg-black">‚úñ</button>
        <h3 id="ab-title" class="text-xl md:text-2xl font-bold gold">Agendar asistencia</h3>
        <div id="ab-subtitle" class="mt-1 text-zinc-300"></div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
          <label class="text-sm block">Nombre
            <input id="ab-name" class="input w-full mt-1" placeholder="Tu nombre">
          </label>
          <label class="text-sm block">Tel√©fono
            <input id="ab-phone" class="input w-full mt-1" placeholder="Tu tel√©fono">
          </label>
          <label class="text-sm block">Fecha y hora
            <input id="ab-dt" type="datetime-local" class="input w-full mt-1">
          </label>
          <label class="text-sm block">Notas
            <input id="ab-notes" class="input w-full mt-1" placeholder="Ej: voy con un amigo">
          </label>
        </div>

        <div class="mt-5 flex flex-wrap gap-2">
          <a id="ab-wa" target="_blank" class="btn" style="background: rgba(197,160,71,.18);">üì≤ Confirmar por WhatsApp</a>
          <button id="ab-ics" class="btn">‚ûï Agregar a mi calendario (.ics)</button>
          <button id="ab-cerrar" class="btn">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIG REGLAS FINANCIACI√ìN ======
    const RULE_SMALL_CC = (cc)=> cc!=null && cc < 249; // <249cc => solo FIJA 89%
    const DEFAULT_PLANS  = ["FIJA","UVA"];
    const DEFAULT_TNA    = { FIJA:54, UVA:20 };
    const DEFAULT_MONTHS = [12,18,24,36,48];

    // ====== DATOS CAT√ÅLOGO ======
    const PRODUCTS = [
      { id:"trk251-2022-gris", title:"Benelli TRK 251 (Usada) 2022 ‚Äì 5.000 km ‚Äì Gris", price:5000000, brand:"Usadas", cc:249, year:2022, km:5000, cover:"/images/trk251.jpg", gallery:["/images/trk251.jpg"], tags:["Usada","Oportunidad"] },
      { id:"benelli-302s",     title:"Benelli 302S",       price:10000000, brand:"Benelli", cc:300, year:0, km:0, cover:"/images/302s.jpg",      gallery:["/images/302s.jpg"],      tags:["En stock"] },
      { id:"benelli-251s",     title:"Benelli 251S",       price:5000000,  brand:"Benelli", cc:249, year:0, km:0, cover:"/images/251s.jpg",      gallery:["/images/251s.jpg"],      tags:["En stock"] },
      { id:"leoncino-500",     title:"Benelli Leoncino 500", price:20000000, brand:"Benelli", cc:500, year:0, km:0, cover:"/images/leoncino500.jpg", gallery:["/images/leoncino500.jpg"], tags:["En stock"] },
      { id:"benelli-180s",     title:"Benelli 180S",       price:3000000,  brand:"Benelli", cc:180, year:0, km:0, cover:"/images/180s.jpg",      gallery:["/images/180s.jpg"],      tags:["En stock"] },
      { id:"benelli-tnt15",    title:"Benelli TNT 15",     price:0,        brand:"Benelli", cc:148, year:0, km:0, cover:"/images/tnt15-1.jpg",  gallery:["/images/tnt15-1.jpg","/images/tnt15-2.jpg","/images/tnt15-3.jpg"], tags:["En stock"] }
    ];

    // ====== EVENTOS (solo futuros; editar ac√°) ======
    // Pr√≥ximo evento solicitado:
    // 18 de agosto de 2025, Parque del Kempes ‚Äì solidario por el D√≠a del Ni√±o.
    const EVENTS = [
      { id:"dia-nino-kempes-2025", title:"D√≠a del Ni√±o ‚Äì Parque del Kempes", when:"2025-08-18T15:00", durationMin:180, place:"Parque del Kempes, C√≥rdoba", description:"Festejo del D√≠a del Ni√±o y convocatoria solidaria para ayudar a los necesitados.", capacity:200 },
      // Pod√©s sumar m√°s eventos a futuro:
      { id:"open-house",   title:"Open House Benelli", when:"2025-09-05T11:00", durationMin:120, place:"Showroom - C√≥rdoba", description:"Lanzamientos, charlas y caf√©.", capacity:50 }
    ];

    // ====== UTIL ======
    const currency = n => new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(n);
    const waBase = "https://wa.me/543512004885";
    const waDefault = "Hola Nacho, quiero info y *Opciones disponibles*";
    const $ = s => document.querySelector(s);

    // ====== STATE (filtros + orden + paginaci√≥n) ======
    let STATE = { q:"", brand:"", minPrice:0, maxPrice:0, sort:"none", page:1, pageSize:10 };

    // ====== TARJETAS CAT√ÅLOGO ======
    function makeCard(p){
      const card = document.createElement("div");
      card.className = "card overflow-hidden";
      card.id = p.id;
      card.innerHTML = `
        <div class="aspect-video bg-cover bg-center" style="background-image:url('${p.cover}'), linear-gradient(120deg,#111,#222)" loading="lazy"></div>
        <div class="p-4">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 class="font-semibold leading-tight">${p.title}</h3>
              <div class="mt-1 text-xs opacity-70">${p.brand} ${p.year>0 ? "‚Ä¢ "+p.year : ""} ${p.km ? "‚Ä¢ "+p.km.toLocaleString("es-AR")+" km" : ""}</div>
            </div>
            <div class="flex gap-2">
              <button class="iconbtn btn-share" title="Compartir">‚Üó</button>
            </div>
          </div>
          <div class="mt-1 text-xl font-bold gold">${currency(p.price)}</div>
          <div class="mt-2 flex flex-wrap gap-2">${(p.tags||[]).map(t=>'<span class="tag">'+t+'</span>').join('')}</div>

          <div class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-2">
            <a href="#" class="btn w-full btn-open-calc">üßÆ Cuotas</a>
            <a target="_blank" href="${waBase}?text=${encodeURIComponent('Hola Nacho, me interesa *'+p.title+'*. ¬øOpciones disponibles?')}" class="btn w-full" style="background: rgba(197,160,71,.18);">üìû WhatsApp</a>
            <a href="#" class="btn w-full md:col-span-1 col-span-2 btn-gallery">üñºÔ∏è Ver fotos</a>
            <a href="#" class="btn w-full md:col-span-1 col-span-2 btn-testdrive">üöó Test drive</a>
          </div>
        </div>`;
      // Listeners
      card.querySelector(".btn-gallery").addEventListener("click",(e)=>{ e.preventDefault(); openGallery(p); });
      card.querySelector(".btn-open-calc").addEventListener("click",(e)=>{ e.preventDefault(); openCalc(p); });
      card.querySelector(".btn-share").addEventListener("click", ()=>{
        const url = location.origin + location.pathname + "#"+p.id;
        const text = `Mir√° esta moto: ${p.title} ‚Äì ${currency(p.price)}\n${url}\n¬øLa vemos?`;
        if (navigator.share) { navigator.share({ title: p.title, text, url }).catch(()=>{}); }
        else { window.open(`https://wa.me/543512004885?text=${encodeURIComponent(text)}`,"_blank"); }
      });
      card.querySelector(".btn-testdrive").addEventListener("click",(e)=>{ e.preventDefault(); openAgenda({ type:"testdrive", title:p.title }); });
      return card;
    }

    function renderGrid(paged){
      const grid = $("#grid");
      grid.innerHTML = "";
      paged.items.forEach(p=> grid.appendChild(makeCard(p)));
      document.getElementById("count").textContent =
        `${paged.total} resultados ¬∑ p√°gina ${paged.page} de ${paged.pages}`;
    }

    // ====== GALER√çA ======
    let LB = { list:[], idx:0 };
    function openGallery(p){ LB.list = (p.gallery && p.gallery.length ? p.gallery : [p.cover]); LB.idx = 0; renderLB(); document.getElementById("lightbox").classList.remove("hidden"); }
    function renderLB(){
      const main = document.getElementById("lb-main");
      const thumbs = document.getElementById("lb-thumbs");
      main.src = LB.list[LB.idx];
      thumbs.innerHTML = "";
      LB.list.forEach((src,i)=>{
        const t = document.createElement("img");
        t.src = src;
        t.className = "h-16 w-full object-cover rounded-md border " + (i===LB.idx ? "border-[var(--gold)]" : "border-white/10");
        t.addEventListener("click", ()=>{ LB.idx=i; renderLB(); });
        thumbs.appendChild(t);
      });
    }
    function lbNext(){ LB.idx = (LB.idx+1) % LB.list.length; renderLB(); }
    function lbPrev(){ LB.idx = (LB.idx-1+LB.list.length) % LB.list.length; renderLB(); }
    document.getElementById("lb-close").onclick = ()=> document.getElementById("lightbox").classList.add("hidden");
    document.getElementById("lb-next").onclick = lbNext;
    document.getElementById("lb-prev").onclick = lbPrev;
    document.getElementById("lightbox").addEventListener("click",(e)=>{ if(e.target.id==="lightbox") document.getElementById("lightbox").classList.add("hidden"); });

    // ====== FINANCIACI√ìN ======
    function getFinanceFor(p){ return (RULE_SMALL_CC(p.cc)) ? { plans:["FIJA"], tna:{FIJA:89}, months: DEFAULT_MONTHS, defaultPlan:"FIJA" } : { plans: DEFAULT_PLANS, tna: DEFAULT_TNA, months: DEFAULT_MONTHS, defaultPlan:"FIJA" }; }
    let CALC_PRODUCT = null;
    function frenchInstallment(amount, months, tna){ const i=(tna/12)/100; if(months<=0||amount<=0) return 0; if(i===0) return amount/months; const f=Math.pow(1+i,months); return amount*((i*f)/(f-1)); }
    function openCalc(p){
      CALC_PRODUCT = p;
      const f = getFinanceFor(p);
      document.getElementById("cb-title").textContent = "Calculadora de cuotas ‚Äì " + p.title;
      document.getElementById("cb-price").textContent = "Precio: " + currency(p.price);
      document.getElementById("cb-entrega").value = 0;
      document.getElementById("cb-meses").value = f.months[0] || 12;
      const planSel = document.getElementById("cb-plan");
      planSel.innerHTML = ""; f.plans.forEach(pl=>{ const opt=document.createElement("option"); opt.value=pl; opt.textContent=pl; planSel.appendChild(opt); });
      planSel.value = f.defaultPlan || f.plans[0];
      const atajos = document.getElementById("cb-atajos"); atajos.innerHTML=""; f.months.forEach(m=>{ const b=document.createElement("button"); b.className="btn cb-atajo"; b.dataset.meses=m; b.textContent=m; b.addEventListener("click", ()=>{ document.getElementById("cb-meses").value=m; updateCalc(); }); atajos.appendChild(b); });
      updateCalc(); document.getElementById("calcbox").classList.remove("hidden");
    }
    function closeCalc(){ document.getElementById("calcbox").classList.add("hidden"); }
    function updateCalc(){
      if(!CALC_PRODUCT) return;
      const f = getFinanceFor(CALC_PRODUCT);
      const entrega = Math.max(parseFloat(document.getElementById("cb-entrega").value||"0"),0);
      const months  = Math.max(parseInt(document.getElementById("cb-meses").value||String(f.months[0]||12)),1);
      const plan    = document.getElementById("cb-plan").value || f.defaultPlan;
      const rate    = (f.tna && f.tna[plan] != null) ? f.tna[plan] : 54;
      document.getElementById("cb-tna-view").textContent = rate + "%";
      const monto   = Math.max(CALC_PRODUCT.price - entrega, 0);
      const cuota   = Math.round(frenchInstallment(monto, months, rate));
      document.getElementById("cb-cuota").textContent = currency(cuota);
      document.getElementById("cb-monto").textContent = "Monto a financiar: " + currency(monto);
      const msg = [
        "Hola Nacho, me interesa *"+CALC_PRODUCT.title+"*.",
        "", "Opciones calculadas:",
        "‚Ä¢ Precio: "+currency(CALC_PRODUCT.price),
        "‚Ä¢ Entrega: "+currency(entrega),
        "‚Ä¢ A financiar: "+currency(monto),
        "‚Ä¢ Plan: "+months+" cuotas ("+plan+", TNA "+rate+"% aprox.)",
        "‚Ä¢ Estimaci√≥n de cuota: "+currency(cuota), "", "¬øLa podemos ver?"
      ].join("\n");
      document.getElementById("cb-wa").href = "https://wa.me/543512004885?text=" + encodeURIComponent(msg);
    }
    document.getElementById("cb-close").onclick  = closeCalc;
    document.getElementById("cb-cerrar").onclick = closeCalc;
    document.getElementById("calcbox").addEventListener("click",(e)=>{ if(e.target.id==="calcbox") closeCalc(); });
    ["cb-entrega","cb-meses","cb-plan"].forEach(id=>{ document.getElementById(id).addEventListener("input", updateCalc); document.getElementById(id).addEventListener("change", updateCalc); });

    // ====== ORDEN + PAGINACI√ìN ======
    function applyFilters(){
      STATE.q        = document.getElementById("q").value.toLowerCase();
      STATE.brand    = document.getElementById("brand").value;
      STATE.minPrice = parseFloat(document.getElementById("minPrice").value || "0");
      STATE.maxPrice = parseFloat(document.getElementById("maxPrice").value || "0");
      STATE.sort     = document.getElementById("sort").value;
      STATE.pageSize = parseInt(document.getElementById("pageSize").value || "10",10);

      let list = PRODUCTS.filter(p=>{
        const s = [p.title, p.brand, String(p.cc||""), String(p.year||"")].join(" ").toLowerCase();
        const okQ = STATE.q ? s.includes(STATE.q) : true;
        const okB = STATE.brand ? p.brand === STATE.brand : true;
        const okMin = STATE.minPrice ? p.price >= STATE.minPrice : true;
        const okMax = STATE.maxPrice ? p.price <= STATE.maxPrice : true;
        return okQ && okB && okMin && okMax;
      });

      const keyers = { "price": p=> p.price||0, "cc": p=> p.cc||0, "year": p=> p.year||0 };
      if(STATE.sort !== "none"){
        const [k,dir] = STATE.sort.split("-");
        const key = keyers[k] || (()=>0);
        list = list.slice().sort((a,b)=> (key(a)-key(b)) * (dir==="asc"?1:-1));
      }

      const total = list.length;
      const pages = Math.max(1, Math.ceil(total / STATE.pageSize));
      if (STATE.page > pages) STATE.page = pages;
      const start = (STATE.page-1) * STATE.pageSize;
      const items = list.slice(start, start + STATE.pageSize);

      renderGrid({items, total, page:STATE.page, pages});
      renderPager({total, page:STATE.page, pages});
    }

    function renderPager({total, page, pages}){
      const mk = (where)=>{
        const host = document.getElementById(where);
        host.innerHTML = "";
        const prev = document.createElement("button");
        prev.className = "iconbtn";
        prev.textContent = "‚óÄ Anterior";
        prev.disabled = page<=1;
        prev.onclick = ()=>{ STATE.page=Math.max(1,STATE.page-1); applyFilters(); };
        const next = document.createElement("button");
        next.className = "iconbtn";
        next.textContent = "Siguiente ‚ñ∂";
        next.disabled = page>=pages;
        next.onclick = ()=>{ STATE.page=Math.min(pages,STATE.page+1); applyFilters(); };
        const label = document.createElement("div");
        label.className = "text-sm opacity-80";
        label.textContent = `P√°gina ${page} de ${pages}`;
        host.appendChild(prev); host.appendChild(label); host.appendChild(next);
      };
      mk("pagerTop"); mk("pagerBottom");
    }

    // ====== AGENDA/EVENTOS ======
    function pad(n){ return String(n).padStart(2,"0"); }
    function toICSDate(dt){
      const d = new Date(dt);
      const y=d.getFullYear(), m=pad(d.getMonth()+1), da=pad(d.getDate()), h=pad(d.getHours()), mi=pad(d.getMinutes());
      return `${y}${m}${da}T${h}${mi}00`;
    }
    function downloadICS({title, desc, start, end, location, filename}){
      const ics = [
        "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Negocios con Ignacio//Agenda//ES",
        "BEGIN:VEVENT",
        "UID:"+ (crypto?.randomUUID ? crypto.randomUUID() : (Date.now()+"@negociosconignacio")),
        "DTSTAMP:"+toICSDate(new Date()),
        "DTSTART:"+toICSDate(start),
        "DTEND:"+toICSDate(end),
        "SUMMARY:"+title,
        "DESCRIPTION:"+desc.replace(/\n/g,"\\n"),
        "LOCATION:"+location,
        "END:VEVENT","END:VCALENDAR"
      ].join("\r\n");
      const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = (filename||"evento") + ".ics";
      document.body.appendChild(a); a.click(); a.remove();
    }

    function futureEvents(source){
      const now = new Date();
      return source
        .map(e=> ({...e, _start: new Date(e.when)}))
        .filter(e=> e._start.getTime() >= now.getTime()) // ocultar pasados
        .sort((a,b)=> a._start - b._start);
    }

    // Contador regresivo
    let COUNTDOWN_TIMER = null;
    function startCountdown(nextEv){
      const wrap = document.getElementById("nextEventWrap");
      const title = document.getElementById("nextEventTitle");
      const meta  = document.getElementById("nextEventMeta");
      const desc  = document.getElementById("nextEventDesc");
      const cd    = document.getElementById("countdown");

      if(!nextEv){
        wrap.classList.add("hidden");
        if(COUNTDOWN_TIMER){ clearInterval(COUNTDOWN_TIMER); COUNTDOWN_TIMER=null; }
        return;
      }

      wrap.classList.remove("hidden");
      title.textContent = nextEv.title;
      meta.textContent  = nextEv._start.toLocaleString("es-AR", { weekday:"long", day:"2-digit", month:"long", hour:"2-digit", minute:"2-digit" }) + " ‚Ä¢ " + (nextEv.place||"C√≥rdoba");
      desc.textContent  = nextEv.description || "";

      // Botones acci√≥n
      document.getElementById("nextEvAgenda").onclick = ()=>{
        const msg = [
          "Hola Nacho, quiero *anotarme*:",
          "‚Ä¢ " + nextEv.title,
          "‚Ä¢ " + nextEv._start.toLocaleString("es-AR"),
          "‚Ä¢ Lugar: " + (nextEv.place||"C√≥rdoba")
        ].join("\n");
        window.open("https://wa.me/543512004885?text="+encodeURIComponent(msg), "_blank");
      };
      document.getElementById("nextEvICS").onclick = ()=>{
        const end = new Date(nextEv._start.getTime() + (nextEv.durationMin||60)*60000);
        downloadICS({ title: nextEv.title, desc: nextEv.description||"", start: nextEv._start, end, location: nextEv.place||"C√≥rdoba", filename: nextEv.id||"evento" });
      };

      if(COUNTDOWN_TIMER){ clearInterval(COUNTDOWN_TIMER); }
      function tick(){
        const now = new Date().getTime();
        const target = nextEv._start.getTime();
        const diff = target - now;
        if(diff <= 0){
          cd.textContent = "¬°Es ahora!";
          clearInterval(COUNTDOWN_TIMER);
          // Re-render para pasar a siguiente evento si existe
          renderEvents();
          return;
        }
        const d = Math.floor(diff/86400000);
        const h = Math.floor((diff%86400000)/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);
        cd.textContent = `${pad(d)}d ${pad(h)}h ${pad(m)}m ${pad(s)}s`;
      }
      tick();
      COUNTDOWN_TIMER = setInterval(tick, 1000);
    }

    function renderEvents(){
      const list = futureEvents(EVENTS);
      // Pr√≥ximo evento
      startCountdown(list[0]);

      // Listado
      const wrap = document.getElementById("eventsList");
      wrap.innerHTML = "";
      list.forEach(ev=>{
        const start = ev._start;
        const end   = new Date(start.getTime() + (ev.durationMin||60)*60000);
        const card = document.createElement("div");
        card.className = "card p-4";
        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-sm opacity-70">${start.toLocaleDateString("es-AR",{weekday:"long", day:"2-digit", month:"long"})} ‚Ä¢ ${start.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})} hs</div>
              <h4 class="font-semibold leading-tight">${ev.title}</h4>
              <div class="text-sm opacity-80">${ev.place||"A confirmar"}</div>
              <p class="text-sm opacity-70 mt-1">${ev.description||""}</p>
              ${ev.capacity? `<div class="text-xs opacity-60 mt-1">Cupo: ${ev.capacity} personas</div>`:""}
            </div>
          </div>
          <div class="mt-3 flex flex-wrap gap-2">
            <button class="btn btn-ev-agendar">üóìÔ∏è Agendar</button>
            <button class="btn btn-ev-ics">‚ûï Agregar a mi calendario</button>
          </div>`;
        // listeners por tarjeta
        card.querySelector(".btn-ev-agendar").addEventListener("click", ()=> openAgenda({
          type:"evento", event:ev, title:ev.title, when:start
        }));
        card.querySelector(".btn-ev-ics").addEventListener("click", ()=>{
          downloadICS({
            title: ev.title,
            desc: ev.description||"Evento Negocios con Ignacio",
            start, end, location: ev.place||"C√≥rdoba",
            filename: ev.id || "evento"
          });
        });
        wrap.appendChild(card);
      });

      // llenar combo de test drive modelos
      const sel = document.getElementById("td-model");
      sel.innerHTML = `<option value="">Eleg√≠ un modelo‚Ä¶</option>`;
      PRODUCTS.forEach(p=>{ const o=document.createElement("option"); o.value=p.title; o.textContent=p.title; sel.appendChild(o); });
    }

    // Modal Agenda
    let AGENDA_CONTEXT = { type:"evento", title:"", when:null, event:null };
    function openAgenda(ctx){
      AGENDA_CONTEXT = ctx || {type:"evento"};
      document.getElementById("ab-title").textContent = (ctx.type==="testdrive"?"Agendar test drive":"Agendar asistencia");
      document.getElementById("ab-subtitle").textContent = ctx.title ? ctx.title : "";
      const dt = document.getElementById("ab-dt");
      if(ctx.when){ dt.value = new Date(ctx.when).toISOString().slice(0,16); }
      else { dt.value = ""; }
      document.getElementById("ab-name").value = "";
      document.getElementById("ab-phone").value = "";
      document.getElementById("ab-notes").value = "";
      document.getElementById("agendabox").classList.remove("hidden");
      updateAgendaLinks();
    }
    function closeAgenda(){ document.getElementById("agendabox").classList.add("hidden"); }

    function updateAgendaLinks(){
      const name = document.getElementById("ab-name").value.trim();
      const phone= document.getElementById("ab-phone").value.trim();
      const notes= document.getElementById("ab-notes").value.trim();
      const dtVal= document.getElementById("ab-dt").value;
      const start = dtVal ? new Date(dtVal) : new Date();
      const end   = new Date(start.getTime() + 60*60000);

      const title = (AGENDA_CONTEXT.type==="testdrive" ? ("Test drive ‚Äì "+(AGENDA_CONTEXT.title||"Modelo a confirmar")) : (AGENDA_CONTEXT.title||"Asistencia a evento"));
      const place = (AGENDA_CONTEXT.type==="testdrive" ? "Showroom Negocios con Ignacio" : (AGENDA_CONTEXT.event?.place || "C√≥rdoba"));
      const desc  = (AGENDA_CONTEXT.type==="testdrive" ? "Turno de prueba de manejo." : (AGENDA_CONTEXT.event?.description || "Evento Negocios con Ignacio"));

      const lines = [
        "Hola Nacho, quiero *agendar*:",
        "‚Ä¢ "+title,
        "‚Ä¢ Fecha/hora: "+ start.toLocaleString("es-AR"),
        name? "‚Ä¢ Nombre: "+name : "",
        phone? "‚Ä¢ Tel: "+phone : "",
        notes? "‚Ä¢ Notas: "+notes : "",
      ].filter(Boolean);

      document.getElementById("ab-wa").href = "https://wa.me/543512004885?text=" + encodeURIComponent(lines.join("\n"));
      document.getElementById("ab-ics").onclick = ()=> downloadICS({
        title, desc, start, end, location: place, filename: (AGENDA_CONTEXT.type==="testdrive"?"test-drive":"evento")
      });
    }

    // Test Drive r√°pido (secci√≥n agenda)
    document.getElementById("td-wa").addEventListener("click", ()=>{
      const model = document.getElementById("td-model").value;
      const dtVal = document.getElementById("td-dt").value;
      const name  = document.getElementById("td-name").value.trim();
      const phone = document.getElementById("td-phone").value.trim();
      if(!model){ alert("Eleg√≠ un modelo."); return; }
      if(!dtVal){ alert("Eleg√≠ fecha y hora."); return; }
      const when = new Date(dtVal);
      const msg = [
        "Hola Nacho, quiero *agendar un test drive*:",
        "‚Ä¢ Modelo: "+model,
        "‚Ä¢ Fecha/hora: "+ when.toLocaleString("es-AR"),
        name? "‚Ä¢ Nombre: "+name : "",
        phone? "‚Ä¢ Tel: "+phone : ""
      ].filter(Boolean).join("\n");
      window.open("https://wa.me/543512004885?text="+encodeURIComponent(msg), "_blank");
    });
    document.getElementById("td-ics").addEventListener("click", ()=>{
      const model = document.getElementById("td-model").value;
      const dtVal = document.getElementById("td-dt").value;
      if(!model || !dtVal){ alert("Eleg√≠ modelo, fecha y hora."); return; }
      const start = new Date(dtVal);
      const end   = new Date(start.getTime()+60*60000);
      downloadICS({ title:"Test drive ‚Äì "+model, desc:"Turno de prueba de manejo", start, end, location:"Showroom Negocios con Ignacio", filename:"test-drive-"+model.replace(/\s+/g,"-").toLowerCase() });
    });

    // Eventos del modal agenda
    document.getElementById("ab-close").onclick  = closeAgenda;
    document.getElementById("ab-cerrar").onclick = closeAgenda;
    document.getElementById("agendabox").addEventListener("click",(e)=>{ if(e.target.id==="agendabox") closeAgenda(); });
    ["ab-name","ab-phone","ab-notes","ab-dt"].forEach(id=>{
      document.getElementById(id).addEventListener("input", updateAgendaLinks);
      document.getElementById(id).addEventListener("change", updateAgendaLinks);
    });

    // ====== INIT ======
    document.getElementById("year").textContent = new Date().getFullYear();
    document.getElementById("wa-hero").href  = "https://wa.me/543512004885?text=" + encodeURIComponent(waDefault);
    document.getElementById("wa-float").href = "https://wa.me/543512004885?text=" + encodeURIComponent(waDefault);

    // Listeners filtros/orden/paginaci√≥n
    ["q","brand","minPrice","maxPrice","sort","pageSize"].forEach(id=>{
      document.getElementById(id).addEventListener("input", ()=>{ STATE.page=1; applyFilters(); });
      document.getElementById(id).addEventListener("change", ()=>{ STATE.page=1; applyFilters(); });
    });
    document.getElementById("clear").addEventListener("click", ()=>{
      ["q","brand","minPrice","maxPrice"].forEach(id=> document.getElementById(id).value="");
      document.getElementById("sort").value="none";
      STATE.page=1;
      applyFilters();
    });

    // Render inicial
    applyFilters();
    renderEvents();
  </script>
</body>
</html>
